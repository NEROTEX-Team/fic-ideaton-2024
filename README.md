# Архитектура высоконагруженного распределенного приложения

- [Архитектура высоконагруженного распределенного приложения](#архитектура-высоконагруженного-распределенного-приложения)
  - [Описание](#описание)
  - [Задача](#задача)
  - [Анализ существующих платформ в Реестре российского программного обеспечения для решения задачи](#анализ-существующих-платформ-в-реестре-российского-программного-обеспечения-для-решения-задачи)
    - [SberTech: Platform V](#sbertech-platform-v)
    - [1C: Облачная платформа](#1c-облачная-платформа)
      - [Решение](#решение)
      - [Особенности](#особенности)
    - [Diasoft: Digital Q](#diasoft-digital-q)
      - [Предлагаемые решения](#предлагаемые-решения)
      - [Особенности](#особенности-1)
    - [Другие компании предоставляющие облачные инфраструктуры](#другие-компании-предоставляющие-облачные-инфраструктуры)
  - [Рекомендации по обеспечению безопасности и защиты от кибератак](#рекомендации-по-обеспечению-безопасности-и-защиты-от-кибератак)
    - [Продуктовые решения](#продуктовые-решения)
      - [Yandex Smart Web Security](#yandex-smart-web-security)
      - [Kaspersky Anti Targeted Attack](#kaspersky-anti-targeted-attack)
  - [Список источников](#список-источников)

<details>
<summary>Задача</summary>

## Описание

Требуется разработать веб-приложение, работающее как в
приватной (внутренний контур), так и в публичной сети и
взаимодействующее посредством портаал с неограниченным
кругом пользователей, как напрямую, так и через ЕПГУ и СМЭВ
(https://info.gosuslugi.ru/docs/). Необходимо провести поиск
архитектурных решений для создания высоконагруженного
территориально-распределенного веб-приложения, способного
обслуживать не менее 100 000 одновременных пользователей.

## Задача

Разработать концептуальную архитектуру веб-приложения с
учетом требований к безопасноит, защитой от кибератак, масштабируемости и высокой на всей территории России.

</details>

## Анализ существующих платформ в Реестре российского программного обеспечения для решения задачи

### SberTech: Platform V

### 1C: Облачная платформа

#### Решение

В готовом облаке 1С пользователю предоставляется рабочее решение пространство
для удаленного доступа из любой точки мира к информационной базе 1С формата
клиент-сервер. Информационная база - это экземпляр одного прикладного решения
"1С: Предприятия 8". Экземпляр состоит из нескольких сущностей:

- Конфигурация (поставщика, базы данных, основная). Программа, которая исполняется.
- База данных. Пользовательский набор данных, который записывается и хранится
- Административная информация. Это, например, могут быть списки пользователей и их роли в проекте или какие-то подобные данные

Данное решение предоставляется облачными провайдерами типа Selectel, Reg.ru и т. д.

Доступные продукты 1С:

- 1С: Бахгалтерия 8 ПРОФ
- 1С: Бухгалртерия 8 КОРП
- 1С: Зарплата и упралвение персоналом ПРОФ
- 1С: Розница
- 1С: Управление нашей фирмой
- 1С: Управление торговлей
- 1С: Документооборот КОРП
- 1С: Документооборот ПРОФ
- 1С: Корпоративный инструментальный пакет 8
- 1С: Предприятие 8. ERP Управление предприятием 2

#### Особенности

- Есть ограничения по количеству лицензий (пользователей) на кластер
- Мощность кластера ограничена мощностями конкретного провайдера и предоставляемыми конфигурациями сервера
- Нельзя сразу сделать кластер с несколькими вычислительными серверами
- Предоставляется только платформа и решения на базе 1С
- Дорогостоящие лицензии

### Diasoft: Digital Q

#### Предлагаемые решения

Компания Diasoft предлагает различные группы платформ для разработки корпоративных решений. При разработке бизнес-приложений используется компонентный подход. Компонентами служат Packaged Business Capabilities (PBC) - приложения, решающие конкретные бизнес-задачи и состоящие из нескольких микросервисов:

- Производственные платформы:
  - [Digital Q.CMDB](https://q.diasoft.ru/products/proizvodstvennye-platformy/digital-q-cmdb/): ведение учета IT-компонентов - от физических стендов до установленных на них продуктов
  - [Digital Q.DevOps](https://q.diasoft.ru/products/proizvodstvennye-platformy/digital-q-devops/): набор инструментов и технологий для процессов непрерывной интеграции, тестирования, доставки и развертывания программных продуктов
  - [Digital Q.DevProfile](https://q.diasoft.ru/products/proizvodstvennye-platformy/digital-q-devprofile/): объединение разных в различных системах ведения проектов для получения отчетностей о работе
  - [Digital Q.Management](https://q.diasoft.ru/products/proizvodstvennye-platformy/digital-q-management/): система управления проектами и спринтами
  - [Digital Q.Tasks](https://q.diasoft.ru/products/proizvodstvennye-platformy/digital-q-tasks/): система управления задачами
  - [Digital Q.Teams](https://q.diasoft.ru/products/proizvodstvennye-platformy/digital-q-teams/): система управления командами
  - [Digital Q.VCS](https://q.diasoft.ru/products/proizvodstvennye-platformy/digital-q-vcs/): система управления исходным кодом
- Технологические платформы:
  - [Digital Q.Archer](https://q.diasoft.ru/products/tekhnologicheskie-platformy/digital-q-archer/)
  - [Digital Q.BPM](https://q.diasoft.ru/products/tekhnologicheskie-platformy/digital-q-bpm/)
  - [Digital Q.DataFlows](https://q.diasoft.ru/products/tekhnologicheskie-platformy/digital-q-dataflows/)
  - [Digital Q.Environment](https://q.diasoft.ru/products/tekhnologicheskie-platformy/digital-q-environment/)
  - [Digital Q.Health](https://q.diasoft.ru/products/tekhnologicheskie-platformy/digital-q-health/)
  - [Digital Q.MessageHub](https://q.diasoft.ru/products/tekhnologicheskie-platformy/digital-q-messagehub/)
  - [Digital Q.Palette](https://q.diasoft.ru/products/tekhnologicheskie-platformy/digital-q-palette/)
  - [Digital Q.Renovation](https://q.diasoft.ru/products/tekhnologicheskie-platformy/digital-q-renovation/)
  - [Digital Q.Sequrity](https://q.diasoft.ru/products/tekhnologicheskie-platformy/digital-q-security/)
  - [Digital Q.Sensor](https://q.diasoft.ru/products/tekhnologicheskie-platformy/digital-q-sensor/)
  - [Digital Q.Blockchain](https://q.diasoft.ru/products/tekhnologicheskie-platformy/digital-q-blockchain/)
  - [Digital Q.Integration](https://q.diasoft.ru/products/tekhnologicheskie-platformy/digital-q-integration/)
- Инфраструктурные платформы:
  - [Digital Q.DataBase](https://q.diasoft.ru/products/infrastrukturnye-platformy/digital-q-database/): платформа для хранения данных на основе PostgreSQL
  - [Digital Q.ELK](https://q.diasoft.ru/products/infrastrukturnye-platformy/digital-q-elk/): классический ElasticSearch, Logstash и Kibana стэк
  - [Digital Q.Kafka](https://q.diasoft.ru/products/infrastrukturnye-platformy/digital-q-kafka/): Apache Kafka
  - [Digital Q.Kubernetes](https://q.diasoft.ru/products/infrastrukturnye-platformy/digital-q-kubernetes/): импортозамещенный Kubernetes и Docker
- Кросс-продуктовые платформы:
  - [Digital Q.Knowledge](https://q.diasoft.ru/products/kross-produktovye-platformy/digital-q-knowledge/): создание систем знаний
  - [Digital Q.ProductCatalog](https://q.diasoft.ru/products/kross-produktovye-platformy/digital-q-productcatalog/): создание и управление каталога цифровых продуктов
  - [Digital Q.Reference](https://q.diasoft.ru/products/kross-produktovye-platformy/digital-q-reference/): единые справочники для сервисов и продуктов
  - [Digital Q.ClientCatalog](https://q.diasoft.ru/products/kross-produktovye-platformy/digital-q-clientcatalog/): единая централизованная база данных всех участников бизнес-процессов организации

#### Особенности

- В основе практически всех решений Diasoft лежат Open Source продукты, которые при желании можно использовать вне экосистемы Diasoft Digital Q - с одной стороны, это плюс, т. к. нет вендор лока, а с другой непонятно, за что именно платим
- Как и другие платформенные решения, здесь есть возможность доработки продуктов только путем настройки конфигурации.
- Есть Low Code инструменты, позволяющие быстро собрать решение с BPM

### Другие компании предоставляющие облачные инфраструктуры

За частую такие компании, как Яндекс, Seletel, Timeweb, Nexign предоставляют облачную инфраструктуру для проектов, которые можно развернуть с использованием MongoDB, PostgreSQL, ELK, Kubernetes и т. д.

Данные решения позволяют снизить затраты на обслуживание инфраструктуры, настройку, бэкапы, выбор ЦОДа, но также они не имеют как-либо специфических доработок.

## Рекомендации по обеспечению безопасности и защиты от кибератак

Защита высоконагруженного и распределенного приложения требует комплексного подхода, учитывающего различные уровни инфраструктуры и приложения. Основные концепции и рекомендации по защите:

1. Сетевая безопасность:
   - Защита от DDoS-атак:
     - Используйте сервисы защиты от DDoS, предоставляемые облачными провайдерами или специализированными компаниями.
     - Реализуйте распределение нагрузки и балансировку трафика для снижения нагрузки на отдельные узлы.
   - Межсетевые экраны и системы обнаружения вторжений:
     - Установите и настройте межсетевые экраны (файрволы) для контроля входящего и исходящего трафика.
     - Внедрите системы обнаружения и предотвращения вторжений (IDS/IPS) для мониторинга подозрительной активности.

2. Безопасность приложения:
   - Безопасное кодирование:
     - Соблюдайте принципы безопасного кодирования, предотвращая распространенные уязвимости (OWASP Top 10).
     - Реализуйте проверку входных данных для защиты от инъекций и XSS-атак.
   - Обновления и патчи:
     - Регулярно обновляйте программное обеспечение и применяйте патчи для устранения известных уязвимостей.
     - Автоматизируйте процесс развертывания обновлений через системы CI/CD с встроенными проверками безопасности.

3. Аутентификация и авторизация:
   - Многофакторная аутентификация (MFA):
     - Введите MFA для доступа к критическим системам и данным.
     - Используйте современные протоколы аутентификации (OAuth 2.0, OpenID Connect).
   - Управление доступом на основе ролей (RBAC):
     - Определите и примените политики доступа на основе ролей и обязанностей пользователей.
     - Ограничьте права доступа принципом наименьших привилегий.

4. Защита данных:
   - Шифрование данных:
     - Используйте шифрование для данных в состоянии покоя (at rest) и при передаче (in transit).
     - Применяйте проверенные криптографические алгоритмы и протоколы (TLS 1.2/1.3).
   - Управление ключами:
     - Используйте защищенные хранилища ключей и секретов.
     - Регулярно обновляйте и ротируйте ключи шифрования.

5. Мониторинг и логирование
   - Централизованный сбор логов:
     - Собирайте и анализируйте логи из всех компонентов системы.
     - Используйте SIEM-системы для обнаружения аномалий и корреляции событий.
   - Микросервисный мониторинг:
     - Внедрите инструменты мониторинга для отслеживания состояния микросервисов и взаимодействия между ними.
     - Используйте распределенный трейсинг для детального анализа запросов.

6. Управление уязвимостями
   - Регулярные аудиты безопасности:
     - Проводите периодические сканирования уязвимостей и пентесты.
     - Используйте автоматизированные инструменты для статического и динамического анализа кода.
   - Управление конфигурацией:
     - Внедрите системы управления конфигурацией для обеспечения единообразия настроек.
     - Контролируйте изменения конфигураций и используйте принципы Immutable Infrastructure.

7. Реагирование на инциденты
   - План реагирования:
     - Разработайте и документируйте планы реагирования на инциденты безопасности.
     - Проведите обучение команды по реагированию на инциденты и регулярные учения.
   - Резервное копирование и восстановление:
     - Настройте регулярное резервное копирование критических данных.
     - Периодически проверяйте возможность восстановления из резервных копий.

8. Безопасность распределенной системы
   - Защищенные коммуникации между узлами:
     - Используйте защищенные каналы связи (VPN, TLS) между различными компонентами системы.
     - Реализуйте аутентификацию и авторизацию сервисов при обмене данными.
   - API безопасность:
     - Ограничьте доступ к API с помощью ключей и токенов доступа.
     - Реализуйте лимиты потребления (rate limiting) для предотвращения злоупотреблений.

9. Безопасность в процессе разработки и развертывания
   - DevSecOps практики:
     - Интегрируйте проверки безопасности на всех этапах разработки и развертывания.
     - Используйте инструменты для анализа кода на уязвимости в процессе CI/CD.
   - Контейнерная безопасность:
     - Обеспечьте безопасность контейнерных образов, используя минимальные базовые образы и регулярно обновляя их.
     - Используйте изолированные пространства выполнения (namespaces) и ограничения по ресурсам (cgroups).

10. Соответствие стандартам и нормативным требованиям
    - Соблюдение отраслевых стандартов:
      - Ориентируйтесь на общепринятые стандарты безопасности (ISO 27001, NIST, PCI DSS).
      - Регулярно проводите аудиты на соответствие требованиям регуляторов.
    - Политики и процедуры безопасности:
      - Разработайте и внедрите внутренние политики информационной безопасности.
      - Обучайте персонал принципам безопасности и повышайте осведомленность о киберугрозах.

### Продуктовые решения

#### Yandex Smart Web Security

Smart Web Security обеспечивает защиту от DDoS‑атак и ботов на уровне приложений, а также защиту от эксплуатации уязвимостей веб‑приложений с помощью встроенного WAF. В его основе — технология Smart Protection от Яндекса, которая больше десяти лет защищает сервисы компании.

SWS состоит из трех ключевых модулей:

1. Защита от DDoS-атак и ботов на уровне приложений (L7). Можно создать правила фильтрации трафика по IP‑адресам, географии, HTTP‑параметрам или содержимому запроса. 
2. Web Application Firewall (WAF). Он анализирует HTTP‑запросы по набору правил OWASP Core Rule Set и защищает от самых опасных уязвимостей из рейтинга OWASP TOP‑10.
3. Advanced Rate Limirer. Он ограничивает количество HTTP‑запросов за определённый промежуток времени — от секунды до часа.

#### Kaspersky Anti Targeted Attack

Для защиты инфраструктуры изнутри необходим постоянный мониторинг и анализ процессов происходящих внутри систем. Для этого может подойти решения типа [Kaspersky Anti Targeted Attack](https://www.kaspersky.ru/enterprise-security/anti-targeted-attack-platform). Они позволяют минимизировать последствия сложных угроз и целевых атак благодаря оперативному выявлению действий злоумышленников за счет:

- Наглядной визуализации, мониторинга и автоматизации процесса сбора и хранения данных, цифровых улик и вердиктов
- Сформированного процесса по анализу сетевого трафика и телеметрии с рабочих мест и автоматическому обнаружению угроз с помощью ряда передовых технологий
- Многоуровневого динамического анализа объектов в изолированной среде для эмуляции вредоносного ПО и противодействия методам обхода песочницы
- Постоянного взаимодействия с глобальной базой знаний об угрозах и автоматического получения информации о репутации файлов, интернет-ресурсов и ПО
- Встроенного сопоставления обнаруженной подозрительной активности с уникальными индикаторами атак (IoA) и базой знаний MITRE ATT&CK
- Сформированной на основе набора разрозненных событий общей картины инцидента и предоставления рекомендаций по расследованию и реагированию

## Список источников

1. [Diasoft Q - Продукты](https://q.diasoft.ru/products/)
2. [Архитектура платформы 1С:Предприятие](https://v8.1c.ru/platforma/oblachnye-tehnologii/)
3. [Selectel - Калькулятор 1С](https://my.selectel.ru/ones/calculator)
4. [Kaspersky Anti Targeted Attack](https://www.kaspersky.ru/enterprise-security/anti-targeted-attack-platform)
5. [Как защитить веб-приложения от кибератак с помощью Yandex Smart Web Security](https://yandex.cloud/ru/blog/posts/2024/11/smart-web-security-protection)
